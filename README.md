# SafeModeDefender v2.1 - 專業級 Windows 安全模式深度清理與修復工具

**版本：2.1**  
**作者：Manus AI & v0re**  
**GitHub：https://github.com/v0re/SafeModeDefender**  
**授權：MIT License**

---

## 目錄

1. [簡介](#簡介)
    - [什麼是 SafeModeDefender？](#什麼是-safemodedefender)
    - [v2.1 新功能](#v21-新功能)
2. [安裝與設定](#安裝與設定)
3. [使用指南](#使用指南)
    - [模式一：交互式選單（GUI）](#模式一交互式選單gui)
    - [模式二：命令列介面（CLI）](#模式二命令列介面cli)
    - [模式三：配置檔批次執行](#模式三配置檔批次執行)
4. [核心功能模塊](#核心功能模塊)
    - [內建模塊](#內建模塊)
    - [外部工具管理器](#外部工具管理器)
5. [使用範例](#使用範例)
6. [常見問題 (FAQ)](#常見問題-faq)
7. [貢獻指南](#貢獻指南)
8. [授權資訊](#授權資訊)

---

## 1. 簡介

### 什麼是 SafeModeDefender？

SafeModeDefender 是一個專為 Windows 安全模式設計的專業級開源安全工具包。它旨在幫助使用者，特別是遭受進階持續性威脅（APT）攻擊的受害者，深度檢測和移除潛伏在系統底層的惡意軟體。本工具基於真實世界的威脅情報（Exploit-DB, Shodan, CVE Database, CISA KEV）開發，提供全面、強大的系統防護與修復能力。

### v2.1 新功能

**SafeModeDefender v2.1** 是一個里程碑式的更新，引入了強大的命令列支援和外部工具整合框架，使其從一個單純的掃描工具演變為一個可擴展的綜合性安全平台。

- **完整的命令列支援**：所有內建模塊和外部工具均可透過 `--cli` 參數在命令列中執行，方便自動化和腳本化操作。
- **外部工具管理器**：整合了 GitHub 上最優質的開源安全工具（如 WinUtil, Optimizer, TestDisk 等），提供統一的中文化介面，無需使用者單獨學習每個工具。
- **雙模式介面**：保留了使用者熟悉的交互式選單（GUI），並與新的命令列介面（CLI）無縫切換。
- **配置檔批次執行**：透過簡單的 JSON 配置檔，可以一次性執行多個掃描和修復任務，實現「一鍵式」安全審計。
- **Wrapper 封裝架構**：所有外部工具均透過獨立的 PowerShell Wrapper 腳本進行封裝，易於維護和擴展。

## 2. 離線部署與安裝

SafeModeDefender v2.2 引入了完整的離線部署支援，確保在沒有網路連線的安全模式下也能正常運作。

### 版本選擇

我們提供兩種版本供您選擇：

- **核心版本 (Core)**：`SafeModeDefender_v2.2_Core.zip` (~10 MB)
  - 包含所有內建模塊和無需網路即可運作的外部工具。
  - **不包含 ClamAV 病毒資料庫**。
  - 適合快速部署或在有網路的環境下使用。

- **完整版本 (Full)**：`SafeModeDefender_v2.2_Full.zip` (~250 MB)
  - 包含所有功能，並**預先打包了最新的 ClamAV 病毒資料庫**。
  - **推薦在完全離線的環境下使用**。

### 安裝步驟

1.  **下載**：從本專案的 [GitHub Releases](https://github.com/v0re/SafeModeDefender/releases) 頁面根據您的需求下載 `Core` 或 `Full` 版本的 ZIP 檔案。
2.  **解壓縮**：將下載的 ZIP 檔案解壓縮到一個方便存取的位置，例如 `C:\Tools\SafeModeDefender`。
3.  **執行**：右鍵點擊 `SafeModeDefender.bat`，選擇「以管理員身份執行」。

**強烈建議**：為了獲得最佳的清理效果和避免惡意軟體干擾，請在 **Windows 安全模式**下執行此工具。

> **如何進入安全模式**：
> 1. 按住 `Shift` 鍵並點擊「重新啟動」。
> 2. 選擇「疑難排解」→「進階選項」→「啟動設定」。
> 3. 按 `F4` 進入安全模式，或按 `F5` 進入含網路功能的安全模式（如果需要下載外部工具）。

## 3. 使用指南

SafeModeDefender v2.1 提供三種靈活的操作模式。

### 離線資源管理

在主選單選擇 `[O]` 或使用 CLI 指令 `--offline-manager` 可以進入離線資源管理器。

```
╔══════════════════════════════════════════════════════════════════════════╗
║                      離線資源狀態檢查                                    ║
╚══════════════════════════════════════════════════════════════════════════╝

  網路狀態：✓ 已連線（可以更新資源）

  【ClamAV 病毒資料庫】
    狀態：⚠ 已過期（45 天前）
    大小：240.5 MB
    建議：此資源為關鍵資源，建議盡快更新

  【WinUtil 腳本和配置】
    狀態：✓ 正常（10 天前）
    大小：0.05 MB
```

- **檢查狀態**：自動檢查所有離線資源的完整性和時效性。
- **更新資源**：在有網路的環境下，可以一鍵下載或更新所有過期的資源，包括 ClamAV 病毒資料庫。

### 模式一：交互式選單（GUI）

這是預設的啟動模式，適合大多數使用者。直接以管理員身份執行 `SafeModeDefender.bat` 即可進入。

```
╔══════════════════════════════════════════════════════════════════════════╗
║                          主選單                                          ║
╚══════════════════════════════════════════════════════════════════════════╝

  [A] 網路服務與端口安全（7 個模塊）
  [B] 系統權限與提權防護（5 個模塊）
  ...
  [I] 防火牆與策略（3 個模塊）

  [T] 外部工具管理器
  [O] 離線資源管理
  [X] 執行完整掃描（所有 33 個模塊）
  [R] 查看報告
  [Q] 退出
```

- **A-I**：執行特定類別的內建模塊掃描。
- **T**：進入外部工具管理器，使用 TestDisk、WinUtil 等強大工具。
- **X**：執行所有 33 個內建模塊的完整掃描。
- **R**：查看已生成的掃描報告。
- **Q**：安全退出。

### 模式二：命令列介面（CLI）

此模式專為進階使用者、系統管理員和自動化腳本設計。透過在 `SafeModeDefender.bat` 後面附加參數來執行。

**基本語法**：
```bash
SafeModeDefender.bat --cli [動作] [目標] [選項]
```

**常用指令**：

- **顯示幫助**：
  ```bash
  SafeModeDefender.bat --help
  ```

- **執行完整掃描**：
  ```bash
  SafeModeDefender.bat --cli --action full
  ```

- **掃描特定類別**（例如：網路安全）：
  ```bash
  SafeModeDefender.bat --cli --action scan --category A
  ```

- **執行特定模塊**：
  ```bash
  SafeModeDefender.bat --cli --action scan --module C1_Autorun_Registry_Scan
  ```

- **使用外部工具**（例如：使用 TestDisk 恢復分區）：
  ```bash
  SafeModeDefender.bat --cli --tool testdisk --action recover_partition
  ```

- **靜默模式自動修復**（不顯示互動提示，自動確認）：
  ```bash
  SafeModeDefender.bat --cli --action fix --category F --silent --autofix
  ```

### 模式三：配置檔批次執行

這是 CLI 模式的延伸，允許您透過一個 JSON 配置檔定義一系列要執行的任務，實現「一鍵式」安全審計和修復。

**執行方法**：
```bash
SafeModeDefender.bat --cli --config <配置檔路徑>
```

**範例配置檔 (`Configs/malware_removal.json`)**：
```json
{
  "name": "惡意軟體移除套件",
  "description": "針對 APT 攻擊的全面惡意軟體檢測和移除流程",
  "tasks": [
    {
      "type": "tool",
      "tool": "clamav",
      "action": "scan"
    },
    {
      "type": "scan",
      "category": "C"
    },
    {
      "type": "scan",
      "category": "D"
    }
  ]
}
```

此配置檔會依次執行以下任務：
1. 使用 ClamAV 進行病毒掃描。
2. 掃描所有註冊表持久化相關的模塊。
3. 掃描所有檔案系統相關的模塊。

您可以在 `Configs/` 目錄下找到更多範例配置檔，並根據自己的需求進行修改。

## 4. 核心功能模塊

### 內建模塊

SafeModeDefender 包含 33 個專業級的內建模塊，分為 9 大類，全面覆蓋 Windows 系統的關鍵安全領域。

| 類別代碼 | 類別名稱 | 模塊數量 | 核心功能 |
|:---:|---|:---:|---|
| **A** | 網路服務與端口安全 | 7 | 掃描和強化 SMB, RDP, WinRM 等服務，檢測危險端口 |
| **B** | 系統權限與提權防護 | 5 | 檢查 UAC 設定、管理員帳戶、計畫任務、服務權限 |
| **C** | 註冊表與持久化防護 | 4 | 掃描啟動項、WMI 持久化、瀏覽器擴展、啟動資料夾 |
| **D** | 檔案系統與隱藏威脅 | 4 | 檢測隱藏檔案、ADS 流、可疑執行檔，驗證系統檔案完整性 |
| **E** | 記憶體與漏洞防護 | 3 | 檢查 DEP/ASLR 設定、系統補丁狀態、記憶體保護 |
| **F** | 隱私權與遙測 | 2 | 禁用 Windows 遙測和資料收集服務 |
| **G** | 系統完整性與更新 | 3 | 執行 SFC 和 DISM 掃描，檢測 BIOS 更新 |
| **H** | 環境變數與 Hosts | 2 | 掃描惡意環境變數和被劫持的 Hosts 檔案 |
| **I** | 防火牆與策略 | 3 | 審計防火牆規則，強化防火牆策略 |

### 外部工具管理器

這是 v2.1 的核心功能。我們從 GitHub 上精選了最優秀的開源安全工具，並為其提供了統一的中文化介面和自動化管理。

**進入方法**：在主選單選擇 `[T]` 或使用 CLI 指令 `--tool <工具名>`。

**已整合工具（第一階段）**：

| 工具名稱 | 星級 | 安全模式 | 核心功能 |
|---|:---:|:---:|---|
| **WinUtil** | 47,600+ | ✓ | 全能 Windows 工具，涵蓋系統優化、修復、調整、安全強化等功能 |
| **Optimizer** | 18,000+ | ✓ | 先進的 Windows 隱私和安全增強工具，修復註冊表、禁用服務、關閉遙測 |
| **TestDisk & PhotoRec** | 2,300+ | ✓ | 強大的磁碟分區恢復和引導扇區修復工具，支援 480+ 檔案格式恢復 |
| **ClamAV** | 6,200+ | ✓ | 開源跨平台防毒引擎，檢測木馬、病毒、惡意軟體 |
| **simplewall** | 8,000+ | ✓ | 輕量級 Windows 過濾平台 (WFP) 管理工具 |
| **PrivescCheck** | 3,700+ | ✓ | PowerShell 權限提升漏洞檢測工具 |

**使用提示**：
- 工具在首次使用時會自動從官方 GitHub 下載，請確保網路連線正常（建議在含網路功能的安全模式下）。
- 所有工具均保留其原始授權，SafeModeDefender 會在使用時顯示相關資訊並鼓勵您支持原作者。

## 5. 使用範例

- **場景一：懷疑感染惡意軟體，進行全面掃描**
  ```bash
  SafeModeDefender.bat --cli --config Configs/malware_removal.json
  ```

- **場景二：系統無法啟動，需要修復引導扇區**
  ```bash
  SafeModeDefender.bat --cli --tool testdisk --action repair_boot
  ```

- **場景三：想要強化系統隱私設定**
  ```bash
  SafeModeDefender.bat --cli --config Configs/privacy_hardening.json
  ```

- **場景四：只想快速檢查註冊表啟動項**
  ```bash
  SafeModeDefender.bat --cli --action scan --module C1_Autorun_Registry_Scan
  ```

## 6. 常見問題 (FAQ)

- **Q: 為什麼一定要在安全模式下執行？**
  A: 在安全模式下，Windows 只會載入最核心的驅動和服務，大多數惡意軟體無法啟動，這使得 SafeModeDefender 可以更徹底地檢測和移除它們，避免在正常模式下被干擾或隱藏。

- **Q: 使用外部工具安全嗎？**
  A: 我們只整合在 GitHub 上經過驗證、廣受好評的開源專案。所有工具均從官方來源下載，並在使用時顯示其授權和來源。我們不修改工具本身，只提供封裝和統一介面。

- **Q: `autofix` 選項會做什麼？**
  A: 該選項會讓 SafeModeDefender 在發現問題時自動執行預設的修復操作，而不會彈出確認提示。這在自動化腳本中非常有用，但請謹慎使用，確保您了解其可能帶來的變更。

## 7. 貢獻指南

我們歡迎任何形式的貢獻！您可以：
- **報告 Bug**：在使用中遇到任何問題，請在 GitHub Issues 中提交詳細報告。
- **提供建議**：對於新功能或改進有任何想法，歡迎提出。
- **提交程式碼**：如果您想整合新的外部工具或改進現有模塊，請 Fork 本專案並提交 Pull Request。
- **完善文檔**：幫助我們改進文檔，使其更清晰、更易於理解。

## 8. 授權資訊

SafeModeDefender 本身採用 **MIT License** 授權。

整合的外部工具保留其各自的原始授權（如 GNU GPL, Apache License 2.0 等）。SafeModeDefender 在使用這些工具時會明確標示其授權資訊。
